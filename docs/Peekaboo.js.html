<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>The Cocktail Toolbox: Source: Peekaboo.js</title>
    
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="dependencies/tct-foundation/dist/tct-foundation.css">
</head>

<body class="antialiased">

<div class="off-canvas-wrap" data-offcanvas>
  <div class="inner-wrap">
    
    <nav class="top-bar docs-bar hide-for-small" data-topbar>
      <ul class="title-area">
        <li class="name">
          <h1><a href="/">The Cocktail <span>Toolbox</span></a></h1>
        </li>
      </ul>
      <section class="top-bar-section">
        <ul class="right">
          <li class="divider"></li>
          <li class="has-form">
            <a href="http://foundation.zurb.com/docs" class="small button">Getting Started</a>
          </li>
        </ul>
      </section>
    </nav>
    
    <nav class="tab-bar show-for-small">
      <div class="left-small">
        <a href="#" role="button" class="left-off-canvas-toggle menu-icon"><span></span></a>
      </div>
    </nav>

    <!-- Off Canvas Menu -->
    <aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        <h2><a href="index.html">Index</a></h2><li class="heading">Classes</li><li><a href="Peekaboo.html">Peekaboo</a></li><li class="divider"></li>
      </ul>
    </aside>

    <!-- close the off-canvas menu -->
    <a class="exit-off-canvas"></a>

    <section class="scroll-container main-section" role="main">
      <div class="row">
        <div class="large-3 medium-4 columns">
          <div class="hide-for-small">
            <div class="sidebar">
              <nav>
                <ul class="side-nav">
                  <h2><a href="index.html">Index</a></h2><li class="heading">Classes</li><li><a href="Peekaboo.html">Peekaboo</a></li><li class="divider"></li>
                </ul>
              </nav>
            </div>
          </div>
        </div>

        <div class="large-9 medium-8 columns">
          <div id="main">
            <h1 class="page-title">Source: Peekaboo.js</h1>
            
            


    
    <section>
        <article>
            <pre class="prettyprint source"><code>if(!this.TCT) this.TCT = {};
this.TCT.Peekaboo = (function(TCT){

  var PeekabooSingletonEnforcer = function(){},
      PeekabooElement = function(element, options){
        this.element = element;
        this.uid = _.uniqueId("peekaboo_");
        this.setOptions(options || {}, this.defaults);
        this.init();
      },
      /**
       * Main Peekaboo class
       * @class  Peekaboo
       * @param {PeekabooSingletonEnforcer} singletonEnforcer Private Peekaboo singleton enforcing class.
       */
      Peekaboo = function(singletonEnforcer){
        if(!singletonEnforcer || !(singletonEnforcer instanceof PeekabooSingletonEnforcer))
          throw(new Error("TCT.Peekaboo is a singleton. Please use TCT.Peekaboo.instance()"));
        this.running = false;
        _.bindAll(this, "onScroll", "onResize");
        this.elements = [];
        this.onScroll = _.debounce(this.onScroll, 100);
        this.onResize = _.debounce(this.onResize, 100);
        this.measure();
      },
      peekabooInstance;

  //  ====================================
  //  = PeekabooElement Instance methods =
  //  ====================================
  $.extend(PeekabooElement.prototype,{
    top: 0,
    bottom: 0,
    defaults:{
      offsetBottom: 0,
      offsetTop: 0,
    },
    init: function(){
      this.visible = false;
      this.measure();
    },
    measure: function(){
      var element = $(this.element);
      this.top = element.offset().top + _.result(this.options, "offsetTop");
      this.bottom = element.offset().top + element.outerHeight() - _.result(this.options,"offsetBottom");
    },
    exec: function(scrollPosition, viewportHeight, prevScroll, direction){
      var state,
          visibleViewport = scrollPosition + viewportHeight,
          visible;
      if(
        // Si ya hemos pasado el tope del elemento, pero aun no hemos dejado de verlo
        (scrollPosition >= this.top && scrollPosition &lt; this.bottom) || 
        // Si el elemento aun no llega arriba, pero se alcanza a ver
        (scrollPosition &lt; this.top && this.top &lt; visibleViewport)
      ){
        state = "visible";
      }else{
        state = "hidden";
      }
      visible = state == "visible";
      if(this.visible != visible){
        this.visible = visible;
        $(this.element).trigger( $.Event(Peekaboo.STATE_CHANGE_EVENT, {
          state: state,
          scroll: scrollPosition,
          prevScroll: prevScroll,
          direction: direction
        }) );
      }
    },
    setOptions: function(options, defaults){
      this.options = $.extend({}, defaults || this.options, options);
      if(typeof options.offsetBottom == "function")
        this.options.offsetBottom = _.bind(this.options.offsetBottom, this);

      if(typeof options.offsetTop == "function")
        this.options.offsetTop = _.bind(this.options.offsetTop, this);
    },
    update: function(options){
      this.setOptions(options);
      this.measure();
    }
  });

  //  ==========================
  //  = Peekaboo Class methods =
  //  ==========================
  $.extend(Peekaboo,{
    STATE_CHANGE_EVENT: "peekaboo_state_change",

    instance: function(){
      if(!peekabooInstance)
        peekabooInstance = new Peekaboo(new PeekabooSingletonEnforcer());
      return peekabooInstance;
    },
    register: function(element, options){
      var instance = this.instance();
      instance.registerElement(element, options);
    },
    setOptions: function(element, options){
      var instance = this.instance();
      instance.setOptionsFor(element, options);
    },
    start: function(){
      this.instance().start();
    },
    stop: function(){
      this.instance().stop();
    }
  });

  //  =============================
  //  = Peekaboo Instance methods =
  //  =============================
  $.extend(Peekaboo.prototype,{
    setOptionsFor: function(element, options){
      element = $(element);
      var uid = element.data("peekaboo_id"),
          peekabooElement = _(this.elements).find(function(pe){
            return pe.uid == uid;
          });
      if(peekabooElement){
        peekabooElement.update(options);
      }
    },
    registerElement: function(element, options){
      if($(element).data("peekaboo_id")) return;
      var peekabooElement = new PeekabooElement(element, options);
      $(element).data("peekaboo_id", peekabooElement.uid);
      this.elements.push(peekabooElement);
    },
    measure: function(){
      this.viewportHeight = $(window).height();
      this.documentHeight = $(document).height() - this.viewportHeight;
    },
    start: function(){
      if(this.running) return;
      $(window)
        .on("scroll.peekaboo_event", this.onScroll)
        .on("resize.peekaboo_event", this.onResize);
      this.running = true;
      this.run();
    },
    stop: function(){
      if(!this.running) return;
      $(window).off(".peekaboo_event");
      this.running = false;
      _(this.elements).each(function(element){
        element.visible = false;
      });
    },
    run: function(){
      if(!this.running) return;
      var scrollPosition = $(document).scrollTop(),
          prevScroll = this.scrollPosition,
          viewportHeight = this.viewportHeight,
          direction = ((typeof prevScroll == "undefined") || (prevScroll == scrollPosition)) ? "none" : scrollPosition > prevScroll ? "down" : "up";
      _(this.elements).each(function(peekabooElement){
        peekabooElement.exec(scrollPosition, viewportHeight, prevScroll, direction);
      });
      this.scrollPosition = scrollPosition;
      this.triggerPosition();
      
    },
    triggerPosition: function(){
      var percent = Math.round((this.scrollPosition / this.documentHeight)*100)/100;
      $(window).trigger($.Event("peekaboo_scroll_position", {
        position: this.scrollPosition,
        percent: percent
      }));
    },
    onScroll: function(e){
      this.run();
    },
    onResize: function(){
      this.measure();
      _(this.elements).each(function(peekabooElement){
        peekabooElement.measure();
      });
      this.run();
    }
  });

  $.fn.peekaboo = function(options){

    return this.each(function(){
      var self = $(this);
      if(!self.data( "peekaboo_id" )){
        Peekaboo.register(this, options);
      }else if(options){
        Peekaboo.setOptions(this, options);
      }
    });

  };

  return Peekaboo;
})();</code></pre>
        </article>
    </section>





          </div>
        </div>
      </div>
      <footer>
        <div class="row">
          Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Fri Nov 07 2014 10:33:16 GMT+0100 (CET)
        </div>
      </footer>
    </section>
  </div>
</div>

<div id="footer">
  <div class="row">
    <div class="full columns">
      <div class="logo_tce">The Cocktail</div>
    </div>
  </div>
</div> 

<script type="text/javascript" src="dependencies/jquery/dist/jquery.min.js"></script> 
<script type="text/javascript" src="dependencies/foundation/js/foundation.min.js"></script> 
<script type="text/javascript" src="dependencies/foundation/js/foundation/foundation.offcanvas.js"></script>
<script type="text/javascript" src="dependencies/prettify/bin/run_prettify.min.js"></script> 
<script type="text/javascript" src="dependencies/tct-foundation/dist/tct-foundation.js"> </script>

</body>
</html>
